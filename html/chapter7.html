<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./">
    <title>第7章：动力学建模与参数辨识</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>目录</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="搜索..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-item " >
                        <a href="index.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">轮足机械臂机器人：从硬件制造到智能算法</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter1.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第1章：轮足机械臂架构概述</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter2.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第2章：执行器选择与优化</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter3.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第3章：机械结构与刚度分析</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter4.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第4章：传感器系统与数据融合</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter5.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第5章：坐标系与姿态表示</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter6.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第6章：正逆运动学与工作空间</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" >
                        <a href="chapter7.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第7章：动力学建模与参数辨识</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter8.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第8章：轨迹规划与优化</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter9.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第9章：全身控制与平衡</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter10.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第10章：阻抗控制与力控制</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter11.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第11章：视觉感知基础</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter12.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第12章：3D感知与场景理解</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter13.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第13章：抓取理论与规划</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter14.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第14章：灵巧操作与双臂协调</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter15.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第15章：行为克隆与模仿学习</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter16.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第16章：扩散模型在机器人中的应用</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter17.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第17章：视觉-语言基础模型</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter18.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第18章：视觉-语言-动作模型(VLA)</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter19.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第19章：世界模型基础</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter20.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第20章：基于模型的规划与控制</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter21.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第21章：系统集成与部署</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter22.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">第22章：计算平台与操作系统</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="CLAUDE.html" class="tree-link">
                            <span class="tree-icon">📄</span>
                            <span class="tree-title">Untitled</span>
                        </a>
                    </div>
                </nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="7">第7章：动力学建模与参数辨识</h1>
<h2 id="_1">学习目标</h2>
<p>本章深入探讨轮足机械臂机器人的动力学建模方法与参数辨识技术。动力学模型是实现高性能控制的基础，它描述了力/力矩与运动之间的关系。我们将对比Newton-Euler和Lagrange两种主流建模方法，讨论柔性关节与传动系统的影响，分析摩擦力的建模与补偿策略，并介绍如何通过实验数据准确辨识动力学参数。通过本章学习，你将掌握构建精确动力学模型的完整流程，为实现基于模型的控制奠定基础。</p>
<h2 id="71">7.1 刚体动力学基础</h2>
<h3 id="711">7.1.1 动力学方程的一般形式</h3>
<p>机器人动力学方程描述了关节力矩与运动状态之间的关系，其一般形式为：</p>
<p>$$\boldsymbol{\tau} = \mathbf{M}(\mathbf{q})\ddot{\mathbf{q}} + \mathbf{C}(\mathbf{q}, \dot{\mathbf{q}})\dot{\mathbf{q}} + \mathbf{G}(\mathbf{q}) + \mathbf{F}(\dot{\mathbf{q}})$$
其中：</p>
<ul>
<li>$\mathbf{M}(\mathbf{q}) \in \mathbb{R}^{n \times n}$：质量矩阵（惯性矩阵），对称正定</li>
<li>$\mathbf{C}(\mathbf{q}, \dot{\mathbf{q}}) \in \mathbb{R}^{n \times n}$：科里奥利力和离心力矩阵</li>
<li>$\mathbf{G}(\mathbf{q}) \in \mathbb{R}^{n}$：重力矩向量</li>
<li>$\mathbf{F}(\dot{\mathbf{q}}) \in \mathbb{R}^{n}$：摩擦力矩向量</li>
<li>$\mathbf{q}, \dot{\mathbf{q}}, \ddot{\mathbf{q}} \in \mathbb{R}^{n}$：关节位置、速度、加速度</li>
</ul>
<p>这个方程揭示了机器人动力学的几个关键特性：</p>
<ol>
<li><strong>非线性耦合</strong>：质量矩阵随配置变化，导致不同关节间的动力学耦合</li>
<li><strong>配置依赖</strong>：重力项依赖于机器人姿态</li>
<li><strong>速度依赖</strong>：科里奥利力与离心力产生速度相关的非线性项</li>
</ol>
<h3 id="712-newton-euler">7.1.2 Newton-Euler递推方法</h3>
<p>Newton-Euler方法基于牛顿第二定律和欧拉方程，通过递推计算每个连杆的力和力矩。该方法计算效率高，复杂度为O(n)，适合实时控制。</p>
<p><strong>前向递推（运动学传播）</strong>：
从基座向末端传递速度和加速度：</p>
<div class="codehilite"><pre><span></span><code>对于 i = 1 到 n：
    ω_{i} = R_{i}^{i-1} ω_{i-1} + ż_i θ̇_i
    α_{i} = R_{i}^{i-1} α_{i-1} + ż_i θ̈_i + ω_{i} × ż_i θ̇_i
    a_{ci} = α_{i} × r_{ci} + ω_{i} × (ω_{i} × r_{ci}) + a_{i}
</code></pre></div>

<p><strong>后向递推（动力学计算）</strong>：
从末端向基座传递力和力矩：</p>
<div class="codehilite"><pre><span></span><code>对于 i = n 到 1：
    F_i = m_i a_{ci}
    N_i = I_{ci} α_i + ω_i × (I_{ci} ω_i)
    f_i = R_{i+1}^i f_{i+1} + F_i
    n_i = R_{i+1}^i n_{i+1} + N_i + r_{ci} × F_i + r_{i+1} × (R_{i+1}^i f_{i+1})
    τ_i = n_i^T z_i + b_i θ̇_i
</code></pre></div>

<p>其中：</p>
<ul>
<li>$ω_i, α_i$：连杆i的角速度和角加速度</li>
<li>$a_{ci}$：连杆i质心的线加速度</li>
<li>$F_i, N_i$：作用在连杆i质心的力和力矩</li>
<li>$f_i, n_i$：关节i处的反作用力和力矩</li>
<li>$I_{ci}$：连杆i相对质心的惯性张量</li>
</ul>
<h3 id="713-lagrange">7.1.3 Lagrange方法</h3>
<p>Lagrange方法基于能量原理，通过系统的动能和势能构建动力学方程。虽然符号计算复杂度较高，但物理意义清晰，便于理解系统的能量流动。</p>
<p><strong>拉格朗日函数</strong>：
$$\mathcal{L}(\mathbf{q}, \dot{\mathbf{q}}) = T(\mathbf{q}, \dot{\mathbf{q}}) - V(\mathbf{q})$$
其中动能为：
$$T = \frac{1}{2}\sum_{i=1}^{n} \left( m_i \mathbf{v}_{ci}^T \mathbf{v}_{ci} + \boldsymbol{\omega}_i^T \mathbf{I}_{ci} \boldsymbol{\omega}_i \right)$$
势能为：
$$V = \sum_{i=1}^{n} m_i g^T \mathbf{p}_{ci}$$
<strong>欧拉-拉格朗日方程</strong>：
$$\tau_i = \frac{d}{dt}\left(\frac{\partial \mathcal{L}}{\partial \dot{q}_i}\right) - \frac{\partial \mathcal{L}}{\partial q_i}$$
展开后可得到标准形式的动力学方程。质量矩阵元素为：
$$M_{ij} = \sum_{k=\max(i,j)}^{n} \text{Tr}\left(\frac{\partial \mathbf{T}_k}{\partial q_i} \mathbf{I}_k \frac{\partial \mathbf{T}_k^T}{\partial q_j}\right)$$</p>
<h3 id="714">7.1.4 两种方法的工程权衡</h3>
<p>| 特性 | Newton-Euler | Lagrange |</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>Newton-Euler</th>
<th>Lagrange</th>
</tr>
</thead>
<tbody>
<tr>
<td>计算复杂度</td>
<td>O(n)</td>
<td>O(n³)符号，O(n²)数值</td>
</tr>
<tr>
<td>物理直观性</td>
<td>力和力矩</td>
<td>能量</td>
</tr>
<tr>
<td>实现难度</td>
<td>中等，需要递推框架</td>
<td>简单，直接计算</td>
</tr>
<tr>
<td>适用场景</td>
<td>实时控制</td>
<td>离线分析、参数辨识</td>
</tr>
<tr>
<td>数值稳定性</td>
<td>优秀</td>
<td>良好</td>
</tr>
<tr>
<td>并行化潜力</td>
<td>有限（递推结构）</td>
<td>高（独立计算项）</td>
</tr>
</tbody>
</table>
<p>在实际工程中，常采用混合策略：</p>
<ul>
<li><strong>控制器设计</strong>：使用Lagrange方法推导解析表达式</li>
<li><strong>实时计算</strong>：使用Newton-Euler递推或预计算的Lagrange模型</li>
<li><strong>参数辨识</strong>：使用Lagrange方法构建线性回归模型</li>
</ul>
<h2 id="72">7.2 柔性关节与传动系统建模</h2>
<h3 id="721">7.2.1 柔性关节动力学</h3>
<p>实际机器人的关节并非完全刚性，谐波减速器、同步带等传动元件引入了柔性。柔性关节模型将电机侧和连杆侧解耦，通过弹性元件连接：
$$\begin{aligned}
\mathbf{M}(\mathbf{q})\ddot{\mathbf{q}} + \mathbf{C}(\mathbf{q}, \dot{\mathbf{q}})\dot{\mathbf{q}} + \mathbf{G}(\mathbf{q}) &amp;= \mathbf{K}(\boldsymbol{\theta} - \mathbf{q}) + \mathbf{D}(\dot{\boldsymbol{\theta}} - \dot{\mathbf{q}}) \\
\mathbf{B}\ddot{\boldsymbol{\theta}} + \mathbf{K}(\boldsymbol{\theta} - \mathbf{q}) + \mathbf{D}(\dot{\boldsymbol{\theta}} - \dot{\mathbf{q}}) &amp;= \boldsymbol{\tau}_m
\end{aligned}$$
其中：</p>
<ul>
<li>$\boldsymbol{\theta}$：电机侧角度</li>
<li>$\mathbf{q}$：连杆侧角度</li>
<li>$\mathbf{B}$：电机转子惯量矩阵</li>
<li>$\mathbf{K}$：关节刚度矩阵</li>
<li>$\mathbf{D}$：关节阻尼矩阵</li>
<li>$\boldsymbol{\tau}_m$：电机力矩</li>
</ul>
<p>这个模型揭示了柔性关节的几个重要特性：</p>
<ol>
<li><strong>共振频率</strong>：$\omega_r = \sqrt{K/J_{eff}}$，其中$J_{eff}$是有效惯量</li>
<li><strong>反共振频率</strong>：出现在电机到连杆的传递函数中</li>
<li><strong>相位滞后</strong>：高频时连杆运动滞后于电机</li>
</ol>
<h3 id="722">7.2.2 传动系统建模</h3>
<p><strong>谐波减速器模型</strong>：
谐波减速器的非线性特性包括：</p>
<ul>
<li><strong>柔性</strong>：扭转刚度约为$10^4 - 10^5$ Nm/rad</li>
<li><strong>迟滞</strong>：约占峰值扭矩的5-15%</li>
<li><strong>动态摩擦</strong>：随速度和负载变化</li>
</ul>
<p>简化的迟滞模型（Bouc-Wen模型）：
$$\tau = K\theta + z$$
$$\dot{z} = A\dot{\theta} - \beta|\dot{\theta}||z|^{n-1}z - \gamma\dot{\theta}|z|^n$$
<strong>同步带/链条传动</strong>：
对于远距离传动，需考虑：</p>
<ul>
<li><strong>带的弹性</strong>：等效刚度$K_{belt} = EA/L$</li>
<li><strong>预紧力影响</strong>：改变系统固有频率</li>
<li><strong>多边形效应</strong>：链条传动的速度波动</li>
</ul>
<h3 id="723">7.2.3 减速比与惯量匹配</h3>
<p>传动系统的减速比n对系统动态特性有重要影响：</p>
<p><strong>反射惯量</strong>：
$$J_{reflected} = J_{load}/n^2$$
<strong>最优减速比</strong>（最大加速度）：
$$n_{opt} = \sqrt{J_{load}/J_{motor}}$$
<strong>带宽考虑</strong>：
实际选择需权衡：</p>
<ul>
<li>大减速比：增大力矩，但降低带宽</li>
<li>小减速比：提高响应速度，但需要大电机</li>
</ul>
<p>工程经验法则：</p>
<div class="codehilite"><pre><span></span><code>轻载高速应用：n = 5-20
重载精密应用：n = 50-160
协作机器人：n = 80-120（平衡安全性与性能）
</code></pre></div>

<h2 id="73">7.3 摩擦力建模与补偿</h2>
<h3 id="731">7.3.1 摩擦力模型</h3>
<p>摩擦力是机器人控制中的主要非线性因素，准确建模对于实现高精度控制至关重要。</p>
<p><strong>静态摩擦模型</strong>：</p>
<ol>
<li>
<p><strong>库仑+粘性摩擦</strong>：
$$F_f = F_c \cdot \text{sgn}(\dot{q}) + B_v \dot{q}$$</p>
</li>
<li>
<p><strong>Stribeck效应</strong>：
$$F_f = \left[F_c + (F_s - F_c)e^{-|\dot{q}/\dot{q}_s|^{\delta}}\right]\text{sgn}(\dot{q}) + B_v \dot{q}$$
其中：</p>
</li>
</ol>
<ul>
<li>$F_c$：库仑摩擦力</li>
<li>$F_s$：静摩擦力（通常$F_s &gt; F_c$）</li>
<li>$B_v$：粘性摩擦系数</li>
<li>$\dot{q}_s$：Stribeck速度</li>
<li>$\delta$：形状参数（通常取2）</li>
</ul>
<p><strong>动态摩擦模型（LuGre模型）</strong>：</p>
<p>LuGre模型通过引入内部状态变量z描述接触面的弹性变形：
$$\begin{aligned}
\dot{z} &amp;= \dot{q} - \frac{\sigma_0 |\dot{q}|}{g(\dot{q})} z \\
F_f &amp;= \sigma_0 z + \sigma_1 \dot{z} + \sigma_2 \dot{q}
\end{aligned}$$
其中：
$$g(\dot{q}) = F_c + (F_s - F_c)e^{-|\dot{q}/\dot{q}_s|^2}$$
参数含义：</p>
<ul>
<li>$\sigma_0$：刚毛刚度</li>
<li>$\sigma_1$：微观阻尼</li>
<li>$\sigma_2$：粘性摩擦</li>
</ul>
<h3 id="732">7.3.2 摩擦力补偿策略</h3>
<p><strong>基于模型的补偿</strong>：</p>
<div class="codehilite"><pre><span></span><code><span class="mf">1.</span><span class="w"> </span><span class="n">离线辨识摩擦参数</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">实时计算摩擦力估计值</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">前馈补偿</span><span class="err">：</span><span class="n">τ_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">τ_desired</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">F_f_estimated</span>
</code></pre></div>

<p><strong>自适应补偿</strong>：
使用在线参数估计更新摩擦模型：
$$\hat{F}_f = \hat{\boldsymbol{\phi}}^T(\dot{q})\hat{\boldsymbol{\theta}}$$
参数更新律：
$$\dot{\hat{\boldsymbol{\theta}}} = -\boldsymbol{\Gamma}\boldsymbol{\phi}(\dot{q})s$$
其中s是滑模变量或跟踪误差。</p>
<p><strong>基于观测器的补偿</strong>：
设计扰动观测器估计包括摩擦在内的总扰动：
$$\begin{aligned}
\hat{d} &amp;= z + p(\dot{q}) \\
\dot{z} &amp;= -L(q)[z + p(\dot{q})] + L(q)[\tau - M(q)\ddot{q}]
\end{aligned}$$</p>
<h3 id="733">7.3.3 低速运动中的摩擦补偿</h3>
<p>低速时摩擦力主导，需要特殊处理：</p>
<p><strong>抖动（Dither）信号</strong>：
添加高频小幅振动打破静摩擦：
$$\tau_{dither} = A\sin(2\pi f_d t)$$
典型参数：</p>
<ul>
<li>幅值A：静摩擦力的10-20%</li>
<li>频率$f_d$：100-500 Hz（高于控制带宽）</li>
</ul>
<p><strong>脉冲控制</strong>：
在过零点附近使用脉冲克服静摩擦：</p>
<div class="codehilite"><pre><span></span><code>if |velocity| &lt; threshold and |position_error| &gt; deadband:
    apply_pulse(sign(position_error) * pulse_amplitude)
</code></pre></div>

<h2 id="74">7.4 参数辨识方法</h2>
<h3 id="741">7.4.1 动力学参数的线性化</h3>
<p>虽然动力学方程关于运动状态是非线性的，但关于动力学参数（质量、质心、惯量）是线性的。这使得我们可以将动力学方程重写为：
$$\boldsymbol{\tau} = \mathbf{Y}(\mathbf{q}, \dot{\mathbf{q}}, \ddot{\mathbf{q}}) \boldsymbol{\pi}$$
其中：</p>
<ul>
<li>$\mathbf{Y}$：回归矩阵（regressor matrix）</li>
<li>$\boldsymbol{\pi}$：最小参数集（基参数）</li>
</ul>
<p><strong>基参数的物理意义</strong>：
每个连杆有10个标准惯性参数：</p>
<ul>
<li>质量：$m_i$</li>
<li>质心位置：$mx_i, my_i, mz_i$</li>
<li>惯量张量：$I_{xx}, I_{xy}, I_{xz}, I_{yy}, I_{yz}, I_{zz}$</li>
</ul>
<p>但并非所有参数都可独立辨识。基参数是可辨识的最小参数集，通常通过符号化简得到。</p>
<h3 id="742">7.4.2 激励轨迹设计</h3>
<p>辨识精度依赖于激励轨迹的设计。最优轨迹应最大化信息矩阵的某个指标。</p>
<p><strong>有限傅里叶级数轨迹</strong>：
$$q_i(t) = q_{i0} + \sum_{k=1}^{N} \frac{a_{ik}}{k\omega} \sin(k\omega t) - \frac{b_{ik}}{k\omega} \cos(k\omega t)$$
优点：</p>
<ul>
<li>周期性，便于多次采样平均</li>
<li>带宽可控</li>
<li>解析计算速度和加速度</li>
</ul>
<p><strong>优化准则</strong>：</p>
<ol>
<li>
<p><strong>条件数最小化</strong>：
$$\min \text{cond}(\mathbf{W}) = \min \frac{\sigma_{max}(\mathbf{W})}{\sigma_{min}(\mathbf{W})}$$</p>
</li>
<li>
<p><strong>D-优化（行列式最大化）</strong>：
$$\max \det(\mathbf{W}^T\mathbf{W})$$
其中$\mathbf{W} = \int_0^T \mathbf{Y}^T\mathbf{Y} dt$是信息矩阵。</p>
</li>
</ol>
<p><strong>约束条件</strong>：</p>
<div class="codehilite"><pre><span></span><code>关节限位：q_min ≤ q(t) ≤ q_max
速度限制：|q̇(t)| ≤ q̇_max
加速度限制：|q̈(t)| ≤ q̈_max
力矩限制：|τ(t)| ≤ τ_max
</code></pre></div>

<h3 id="743">7.4.3 参数估计算法</h3>
<p><strong>最小二乘法（LS）</strong>：
基本的参数估计：
$$\hat{\boldsymbol{\pi}} = (\mathbf{Y}^T\mathbf{Y})^{-1}\mathbf{Y}^T\boldsymbol{\tau}$$
<strong>加权最小二乘（WLS）</strong>：
考虑测量噪声的异方差性：
$$\hat{\boldsymbol{\pi}} = (\mathbf{Y}^T\mathbf{W}\mathbf{Y})^{-1}\mathbf{Y}^T\mathbf{W}\boldsymbol{\tau}$$
权重矩阵W通常选择为噪声协方差的逆。</p>
<p><strong>最大似然估计（MLE）</strong>：
假设噪声模型：
$$\boldsymbol{\tau} = \mathbf{Y}\boldsymbol{\pi} + \boldsymbol{\epsilon}, \quad \boldsymbol{\epsilon} \sim \mathcal{N}(0, \boldsymbol{\Sigma})$$
对数似然函数：
$$\mathcal{L} = -\frac{1}{2}(\boldsymbol{\tau} - \mathbf{Y}\boldsymbol{\pi})^T\boldsymbol{\Sigma}^{-1}(\boldsymbol{\tau} - \mathbf{Y}\boldsymbol{\pi})$$
<strong>贝叶斯估计</strong>：
引入参数的先验分布：
$$p(\boldsymbol{\pi}) = \mathcal{N}(\boldsymbol{\pi}_0, \boldsymbol{\Sigma}_0)$$
后验分布：
$$p(\boldsymbol{\pi}|\boldsymbol{\tau}) \propto p(\boldsymbol{\tau}|\boldsymbol{\pi})p(\boldsymbol{\pi})$$
MAP估计：
$$\hat{\boldsymbol{\pi}}_{MAP} = \arg\max_{\boldsymbol{\pi}} [p(\boldsymbol{\tau}|\boldsymbol{\pi})p(\boldsymbol{\pi})]$$</p>
<h3 id="744">7.4.4 在线辨识与自适应</h3>
<p><strong>递推最小二乘（RLS）</strong>：</p>
<div class="codehilite"><pre><span></span><code>初始化：P(0) = αI, θ̂(0) = θ_0
对于每个新样本(y_k, φ_k)：
    e_k = y_k - φ_k^T θ̂_{k-1}
    K_k = P_{k-1}φ_k / (λ + φ_k^T P_{k-1} φ_k)
    θ̂_k = θ̂_{k-1} + K_k e_k
    P_k = (I - K_k φ_k^T)P_{k-1}/λ
</code></pre></div>

<p>其中λ是遗忘因子（0.95-0.99）。</p>
<p><strong>扩展卡尔曼滤波（EKF）辨识</strong>：
将参数作为状态变量：
$$\begin{aligned}
\mathbf{x} &amp;= [\mathbf{q}^T, \dot{\mathbf{q}}^T, \boldsymbol{\pi}^T]^T \\
\dot{\mathbf{x}} &amp;= f(\mathbf{x}, \mathbf{u}) + \mathbf{w}
\end{aligned}$$
测量方程：
$$\mathbf{z} = h(\mathbf{x}) + \mathbf{v}$$</p>
<h3 id="745">7.4.5 物理一致性约束</h3>
<p>辨识的参数应满足物理约束：</p>
<p><strong>质量正定性</strong>：
$$m_i &gt; 0$$
<strong>惯量矩阵正定性</strong>：
$$\mathbf{I}_i = \begin{bmatrix}
I_{xx} &amp; I_{xy} &amp; I_{xz} \\
I_{xy} &amp; I_{yy} &amp; I_{yz} \\
I_{xz} &amp; I_{yz} &amp; I_{zz}
\end{bmatrix} \succ 0$$
<strong>三角不等式</strong>：
$$\begin{aligned}
I_{xx} + I_{yy} &amp;\geq I_{zz} \\
I_{yy} + I_{zz} &amp;\geq I_{xx} \\
I_{zz} + I_{xx} &amp;\geq I_{yy}
\end{aligned}$$
<strong>质心位置约束</strong>：
$$|\mathbf{r}_{ci}| \leq r_{max}$$
这些约束可通过约束优化方法（如SDP）强制满足。</p>
<h2 id="kuka-iiwa">案例研究：KUKA iiwa的动力学补偿</h2>
<p>KUKA iiwa是一款7自由度协作机器人，以其精确的动力学补偿和力矩控制能力著称。</p>
<h3 id="_2">系统架构</h3>
<p>iiwa采用分层控制架构：</p>
<ol>
<li><strong>位置控制器</strong>（1 kHz）：笛卡尔/关节空间轨迹跟踪</li>
<li><strong>动力学补偿</strong>（3 kHz）：重力、科里奥利力实时计算</li>
<li><strong>力矩控制器</strong>（10 kHz）：电流环控制</li>
</ol>
<h3 id="_3">动力学模型特点</h3>
<p><strong>谐波减速器建模</strong>：</p>
<ul>
<li>每个关节配备高精度扭矩传感器</li>
<li>实测刚度：$10^4 - 10^5$ Nm/rad</li>
<li>考虑温度对刚度的影响（约20%变化）</li>
</ul>
<p><strong>摩擦补偿</strong>：</p>
<ul>
<li>使用分段线性模型近似Stribeck曲线</li>
<li>温度补偿：$F_f(T) = F_f(T_0)[1 + \alpha(T-T_0)]$</li>
<li>负载自适应：根据负载调整摩擦参数</li>
</ul>
<h3 id="_4">参数辨识流程</h3>
<ol>
<li><strong>预热程序</strong>：运行标准轨迹30分钟达到热平衡</li>
<li><strong>激励轨迹</strong>：5阶傅里叶级数，基频0.05 Hz</li>
<li><strong>数据采集</strong>：10 kHz采样，低通滤波至100 Hz</li>
<li><strong>迭代辨识</strong>：
   - 第一轮：辨识惯性参数
   - 第二轮：固定惯性参数，辨识摩擦
   - 第三轮：联合优化</li>
</ol>
<h3 id="_5">性能指标</h3>
<p>通过精确的动力学补偿，iiwa实现了：</p>
<ul>
<li>重复定位精度：±0.1 mm</li>
<li>力矩估计误差：&lt; 2% 额定力矩</li>
<li>外力检测阈值：&lt; 2 N（末端）</li>
<li>重力补偿精度：&lt; 0.5% 负载重量</li>
</ul>
<h3 id="_6">工程启示</h3>
<ol>
<li><strong>传感器融合</strong>：结合电机编码器和关节扭矩传感器提高估计精度</li>
<li><strong>温度补偿</strong>：工业应用必须考虑温度变化</li>
<li><strong>在线更新</strong>：通过持续学习适应磨损和老化</li>
<li><strong>安全裕度</strong>：参数不确定性纳入安全策略设计</li>
</ol>
<h2 id="lcp">高级话题：接触动力学与LCP</h2>
<h3 id="_7">接触力计算</h3>
<p>多点接触时，接触力需满足：</p>
<ol>
<li><strong>非穿透约束</strong>：$\phi_i(\mathbf{q}) \geq 0$</li>
<li><strong>非负法向力</strong>：$f_{n,i} \geq 0$</li>
<li><strong>互补条件</strong>：$\phi_i f_{n,i} = 0$</li>
<li><strong>摩擦锥约束</strong>：$|\mathbf{f}_{t,i}| \leq \mu f_{n,i}$</li>
</ol>
<p>这构成一个线性互补问题（LCP）：
$$\begin{aligned}
\mathbf{w} &amp;= \mathbf{M}\mathbf{z} + \mathbf{q} \\
\mathbf{w} &amp;\geq 0, \quad \mathbf{z} \geq 0 \\
\mathbf{w}^T\mathbf{z} &amp;= 0
\end{aligned}$$</p>
<h3 id="_8">求解方法</h3>
<p><strong>Lemke算法</strong>：
主元算法，保证有限步收敛，但可能遇到退化。</p>
<p><strong>投影Gauss-Seidel（PGS）</strong>：</p>
<div class="codehilite"><pre><span></span><code>for iteration = 1 to max_iter:
    for each contact i:
        z_i = max(0, z_i - ω(Mz + q)_i/M_{ii})
</code></pre></div>

<p>收敛速度依赖于松弛因子ω的选择。</p>
<p><strong>基于优化的方法</strong>：
将LCP转换为二次规划（QP）：
$$\min_{\mathbf{z}} \frac{1}{2}\mathbf{z}^T\mathbf{M}\mathbf{z} + \mathbf{q}^T\mathbf{z}, \quad \text{s.t. } \mathbf{z} \geq 0$$</p>
<h3 id="_9">工程考虑</h3>
<ol>
<li><strong>刚度选择</strong>：过大导致数值不稳定，过小导致穿透</li>
<li><strong>时间步长</strong>：显式积分需要小步长（&lt; 1 ms）</li>
<li><strong>正则化</strong>：添加阻尼项改善条件数</li>
<li><strong>接触检测</strong>：使用空间哈希或BVH加速</li>
</ol>
<h2 id="_10">本章小结</h2>
<p>本章系统介绍了轮足机械臂机器人的动力学建模与参数辨识：</p>
<p><strong>关键概念</strong>：</p>
<ol>
<li>动力学方程的一般形式：$\boldsymbol{\tau} = \mathbf{M}(\mathbf{q})\ddot{\mathbf{q}} + \mathbf{C}(\mathbf{q}, \dot{\mathbf{q}})\dot{\mathbf{q}} + \mathbf{G}(\mathbf{q}) + \mathbf{F}(\dot{\mathbf{q}})$</li>
<li>Newton-Euler递推：O(n)复杂度，适合实时控制</li>
<li>Lagrange方法：基于能量，便于符号推导</li>
<li>柔性关节模型：考虑传动系统柔性的双惯量模型</li>
<li>摩擦模型：从简单的库仑+粘性到复杂的LuGre模型</li>
<li>参数线性化：$\boldsymbol{\tau} = \mathbf{Y}(\mathbf{q}, \dot{\mathbf{q}}, \ddot{\mathbf{q}}) \boldsymbol{\pi}$</li>
<li>激励轨迹优化：最大化信息矩阵的可观测性</li>
</ol>
<p><strong>实践要点</strong>：</p>
<ul>
<li>根据控制需求选择合适的模型复杂度</li>
<li>摩擦补偿对低速精度至关重要</li>
<li>参数辨识需要精心设计的激励轨迹</li>
<li>物理一致性约束确保辨识结果合理</li>
<li>温度和负载变化需要在线适应</li>
</ul>
<p>掌握这些概念和方法，你将能够为机器人构建精确的动力学模型，这是实现高性能控制的基础。下一章我们将探讨如何利用这些模型进行轨迹规划与优化。</p>
<h2 id="_11">练习题</h2>
<h3 id="_12">基础题</h3>
<p><strong>练习7.1</strong> 推导2-DOF平面机械臂的动力学方程
考虑一个2自由度平面机械臂，连杆长度为$l_1, l_2$，质量为$m_1, m_2$，质心位于连杆中点。使用Lagrange方法推导其动力学方程，并识别质量矩阵、科里奥利矩阵和重力向量。</p>
<p><em>提示：先写出每个连杆质心的位置，计算动能和势能。</em></p>
<details>
<summary>参考答案</summary>
<p>质心位置：</p>
<ul>
<li>连杆1：$x_{c1} = \frac{l_1}{2}\cos q_1, y_{c1} = \frac{l_1}{2}\sin q_1$</li>
<li>连杆2：$x_{c2} = l_1\cos q_1 + \frac{l_2}{2}\cos(q_1+q_2), y_{c2} = l_1\sin q_1 + \frac{l_2}{2}\sin(q_1+q_2)$</li>
</ul>
<p>动能：
$$T = \frac{1}{2}[m_1(\frac{l_1}{2})^2 + I_1]\dot{q}_1^2 + \frac{1}{2}[m_2l_1^2\dot{q}_1^2 + m_2(\frac{l_2}{2})^2(\dot{q}_1+\dot{q}_2)^2 + I_2(\dot{q}_1+\dot{q}_2)^2 + 2m_2l_1\frac{l_2}{2}\cos q_2\dot{q}_1(\dot{q}_1+\dot{q}_2)]$$
质量矩阵：
$$\mathbf{M} = \begin{bmatrix}
m_1(\frac{l_1}{2})^2 + m_2l_1^2 + m_2(\frac{l_2}{2})^2 + I_1 + I_2 + m_2l_1l_2\cos q_2 &amp; m_2(\frac{l_2}{2})^2 + I_2 + \frac{1}{2}m_2l_1l_2\cos q_2 \\
m_2(\frac{l_2}{2})^2 + I_2 + \frac{1}{2}m_2l_1l_2\cos q_2 &amp; m_2(\frac{l_2}{2})^2 + I_2
\end{bmatrix}$$
科里奥利矩阵：
$$\mathbf{C} = \begin{bmatrix}
-m_2l_1\frac{l_2}{2}\sin q_2 \dot{q}_2 &amp; -m_2l_1\frac{l_2}{2}\sin q_2(\dot{q}_1+\dot{q}_2) \\
m_2l_1\frac{l_2}{2}\sin q_2 \dot{q}_1 &amp; 0
\end{bmatrix}$$
重力向量：
$$\mathbf{G} = \begin{bmatrix}
(m_1\frac{l_1}{2} + m_2l_1)g\cos q_1 + m_2\frac{l_2}{2}g\cos(q_1+q_2) \\
m_2\frac{l_2}{2}g\cos(q_1+q_2)
\end{bmatrix}$$</p>
</details>
<p><strong>练习7.2</strong> Newton-Euler递推实现
编写伪代码实现3-DOF机械臂的Newton-Euler递推算法。假设已知每个连杆的质量$m_i$、质心位置$\mathbf{r}_{ci}$、惯性张量$\mathbf{I}_i$，以及当前的关节位置、速度和加速度。</p>
<p><em>提示：分别实现前向运动学递推和后向动力学递推。</em></p>
<details>
<summary>参考答案</summary>
<div class="codehilite"><pre><span></span><code><span class="o">//</span><span class="w"> </span><span class="n">前向递推</span>
<span class="n">ω</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">α</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">g</span>
<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">3</span><span class="err">:</span>
<span class="w">    </span><span class="n">R</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rz</span><span class="p">(</span><span class="n">q</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">R</span><span class="o">[</span><span class="n">i-1</span><span class="o">]</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">旋转矩阵</span>
<span class="w">    </span><span class="n">ω</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="o">[</span><span class="n">i</span><span class="o">]^</span><span class="n">T</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">ω</span><span class="o">[</span><span class="n">i-1</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="n">0, 0, q̇[i</span><span class="o">]</span><span class="err">]</span>
<span class="w">    </span><span class="n">α</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="o">[</span><span class="n">i</span><span class="o">]^</span><span class="n">T</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">α</span><span class="o">[</span><span class="n">i-1</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">[</span><span class="n">0, 0, q̈[i</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">cross</span><span class="p">(</span><span class="n">ω</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">0, 0, q̇[i</span><span class="o">]</span><span class="err">]</span><span class="p">)</span>
<span class="w">    </span><span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="o">[</span><span class="n">i</span><span class="o">]^</span><span class="n">T</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="o">[</span><span class="n">i-1</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">cross</span><span class="p">(</span><span class="n">α</span><span class="o">[</span><span class="n">i-1</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">cross</span><span class="p">(</span><span class="n">ω</span><span class="o">[</span><span class="n">i-1</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="k">cross</span><span class="p">(</span><span class="n">ω</span><span class="o">[</span><span class="n">i-1</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)))</span>
<span class="w">    </span><span class="n">ac</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">cross</span><span class="p">(</span><span class="n">α</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">rc</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">cross</span><span class="p">(</span><span class="n">ω</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="k">cross</span><span class="p">(</span><span class="n">ω</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">rc</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">))</span>

<span class="o">//</span><span class="w"> </span><span class="n">后向递推</span>
<span class="n">f</span><span class="o">[</span><span class="n">4</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">[</span><span class="n">4</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">末端无外力</span>
<span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>
<span class="w">    </span><span class="n">F</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ac</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
<span class="w">    </span><span class="n">N</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">α</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">cross</span><span class="p">(</span><span class="n">ω</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">I</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">ω</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span>
<span class="w">    </span><span class="n">f</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="o">[</span><span class="n">i+1</span><span class="o">]</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">f</span><span class="o">[</span><span class="n">i+1</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">F</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
<span class="w">    </span><span class="n">n</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="o">[</span><span class="n">i+1</span><span class="o">]</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">n</span><span class="o">[</span><span class="n">i+1</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">cross</span><span class="p">(</span><span class="n">rc</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">cross</span><span class="p">(</span><span class="n">p</span><span class="o">[</span><span class="n">i+1</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">[</span><span class="n">i+1</span><span class="o">]</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">f</span><span class="o">[</span><span class="n">i+1</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">N</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>
<span class="w">    </span><span class="n">τ</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="err">·</span><span class="w"> </span><span class="o">[</span><span class="n">0, 0, 1</span><span class="o">]</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="n">提取z分量</span>
</code></pre></div>

</details>
<p><strong>练习7.3</strong> 摩擦力参数辨识
给定一组低速运动数据（速度范围：-0.1到0.1 rad/s），设计一个方法辨识Stribeck摩擦模型的参数。数据格式为$(
\dot{q}<em friction_i="friction,i">i, \tau</em>)$。</p>
<p><em>提示：使用非线性最小二乘拟合。</em></p>
<details>
<summary>参考答案</summary>
<p>Stribeck模型：
$$F_f = [F_c + (F_s - F_c)e^{-|\dot{q}/\dot{q}_s|^2}]\text{sgn}(\dot{q}) + B_v\dot{q}$$
辨识步骤：</p>
<ol>
<li>分离正负速度数据</li>
<li>
<p>初始参数估计：
   - $F_s$：$\dot{q} \approx 0$时的摩擦力
   - $F_c$：高速时的摩擦力渐近值
   - $B_v$：高速区域的斜率
   - $\dot{q}_s$：Stribeck下降区的特征速度</p>
</li>
<li>
<p>非线性优化：</p>
</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">q_dot</span><span class="p">,</span> <span class="n">tau_measured</span><span class="p">):</span>
    <span class="n">Fc</span><span class="p">,</span> <span class="n">Fs</span><span class="p">,</span> <span class="n">Bv</span><span class="p">,</span> <span class="n">qs</span> <span class="o">=</span> <span class="n">params</span>
    <span class="n">tau_pred</span> <span class="o">=</span> <span class="p">(</span><span class="n">Fc</span> <span class="o">+</span> <span class="p">(</span><span class="n">Fs</span><span class="o">-</span><span class="n">Fc</span><span class="p">)</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">q_dot</span><span class="o">/</span><span class="n">qs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">sign</span><span class="p">(</span><span class="n">q_dot</span><span class="p">)</span> <span class="o">+</span> <span class="n">Bv</span><span class="o">*</span><span class="n">q_dot</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="n">tau_measured</span> <span class="o">-</span> <span class="n">tau_pred</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">params_opt</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">params_init</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">q_dot_data</span><span class="p">,</span> <span class="n">tau_data</span><span class="p">))</span>
</code></pre></div>

<ol start="4">
<li>验证对称性：正负方向参数应相近</li>
</ol>
</details>
<p><strong>练习7.4</strong> 基参数计算
对于一个3-DOF机械臂，原始有30个惯性参数（每个连杆10个）。说明如何通过符号运算确定基参数集，并给出可能的基参数数量。</p>
<p><em>提示：考虑哪些参数组合总是一起出现在动力学方程中。</em></p>
<details>
<summary>参考答案</summary>
<p>基参数确定方法：</p>
<ol>
<li>写出符号形式的动力学方程</li>
<li>识别线性相关的参数组合</li>
<li>常见的参数组合：
   - 第一个连杆的$I_{zz,1} + m_2l_1^2 + m_3l_1^2$总是一起出现
   - 末端连杆绕其关节轴的惯量独立
   - 零重力方向的质心坐标不可辨识</li>
</ol>
<p>对于3-DOF平面机械臂：</p>
<ul>
<li>原始参数：30个</li>
<li>不可辨识：沿重力方向的质心坐标（3个）</li>
<li>组合参数：约6-8个</li>
<li>基参数数量：通常为12-15个</li>
</ul>
<p>具体数量取决于：</p>
<ul>
<li>机械臂构型（串联/并联）</li>
<li>关节类型（旋转/移动）</li>
<li>重力方向</li>
</ul>
</details>
<h3 id="_13">挑战题</h3>
<p><strong>练习7.5</strong> 柔性关节控制器设计
考虑单自由度柔性关节：
$$\begin{aligned}
J_l\ddot{q} + mgl\sin(q) &amp;= k(\theta - q) \\
J_m\ddot{\theta} &amp;= \tau - k(\theta - q)
\end{aligned}$$
其中$J_l=1$, $J_m=0.1$, $k=100$, $mgl=10$。设计一个控制器实现位置跟踪，分析系统的稳定性和振动抑制。</p>
<p><em>提示：考虑基于奇异摄动理论的双时间尺度控制。</em></p>
<details>
<summary>参考答案</summary>
<p>系统分析：</p>
<ol>
<li>
<p>固有频率：
   - 刚体模式：$\omega_1 \approx \sqrt{mgl/J_l} \approx 3.16$ rad/s
   - 弹性模式：$\omega_2 = \sqrt{k(1/J_m + 1/J_l)} \approx 33.2$ rad/s</p>
</li>
<li>
<p>双时间尺度控制：
   - 慢子系统（刚体）：忽略弹性，设计PD控制器
   - 快子系统（振动）：主动阻尼控制</p>
</li>
</ol>
<p>控制律：
$$\tau = k(\theta_d - \theta) + b(\dot{\theta}_d - \dot{\theta}) + k(q - \theta) + \tau_{ff}$$
其中：</p>
<ul>
<li>前馈：$\tau_{ff} = mgl\sin(q_d)$</li>
<li>位置环：$\theta_d = q_d + (mgl\sin(q_d))/k$</li>
<li>阻尼：$b = 2\zeta\sqrt{kJ_m}$，$\zeta \approx 0.7$</li>
</ul>
<p>稳定性分析：</p>
<ul>
<li>使用Lyapunov函数证明渐近稳定</li>
<li>通过根轨迹分析选择增益</li>
</ul>
</details>
<p><strong>练习7.6</strong> 在线参数自适应
设计一个自适应控制器，同时跟踪期望轨迹并在线估计未知的负载质量。考虑2-DOF机械臂末端抓取未知质量$m_L$的负载。</p>
<p><em>提示：使用Slotine-Li自适应控制方法。</em></p>
<details>
<summary>参考答案</summary>
<p>自适应控制律：
$$\boldsymbol{\tau} = \hat{\mathbf{M}}\ddot{\mathbf{q}}_r + \hat{\mathbf{C}}\dot{\mathbf{q}}_r + \hat{\mathbf{G}} + \mathbf{K}_D\mathbf{s}$$
其中：</p>
<ul>
<li>滑模变量：$\mathbf{s} = \dot{\tilde{\mathbf{q}}} + \boldsymbol{\Lambda}\tilde{\mathbf{q}}$</li>
<li>参考速度：$\dot{\mathbf{q}}_r = \dot{\mathbf{q}}_d - \boldsymbol{\Lambda}\tilde{\mathbf{q}}$</li>
</ul>
<p>参数更新律：
$$\dot{\hat{m}}_L = -\gamma \mathbf{Y}_L^T(\mathbf{q}, \dot{\mathbf{q}}_r, \ddot{\mathbf{q}}_r)\mathbf{s}$$
其中$\mathbf{Y}_L$是负载质量的回归向量。</p>
<p>Lyapunov函数：
$$V = \frac{1}{2}\mathbf{s}^T\mathbf{M}\mathbf{s} + \frac{1}{2\gamma}\tilde{m}_L^2$$
证明$\dot{V} \leq -\mathbf{s}^T\mathbf{K}_D\mathbf{s} \leq 0$，系统全局渐近稳定。</p>
<p>实现细节：</p>
<ul>
<li>参数投影保证$\hat{m}_L \geq 0$</li>
<li>死区修正避免噪声驱动</li>
<li>持续激励条件保证参数收敛</li>
</ul>
</details>
<p><strong>练习7.7</strong> 多接触场景的LCP求解
机器人手抓握一个立方体，有4个接触点，每个接触点有3维接触力（1个法向，2个切向）。建立LCP问题并说明求解策略。摩擦系数$\mu=0.3$。</p>
<p><em>提示：使用摩擦锥的线性化近似。</em></p>
<details>
<summary>参考答案</summary>
<p>问题建立：</p>
<ol>
<li>变量：12个接触力分量</li>
<li>
<p>动力学约束：
$$\mathbf{M}\ddot{\mathbf{q}} = \mathbf{J}_c^T\mathbf{f}_c + \boldsymbol{\tau}$$</p>
</li>
<li>
<p>接触约束：
   - 非穿透：$\phi_i \geq 0$
   - 非负法向力：$f_{n,i} \geq 0$
   - 互补性：$\phi_i f_{n,i} = 0$</p>
</li>
<li>
<p>摩擦锥线性化（4面锥）：
$$\mathbf{D}_i\mathbf{f}_{t,i} \leq \mu f_{n,i}\mathbf{e}$$
其中$\mathbf{D}_i$定义4个摩擦面。</p>
</li>
</ol>
<p>LCP形式：
$$\begin{bmatrix}
\mathbf{A} &amp; -\mathbf{J}_c^T \\
\mathbf{J}_c &amp; \mathbf{0}
\end{bmatrix}
\begin{bmatrix}
\ddot{\mathbf{q}} \\
\boldsymbol{\lambda}
\end{bmatrix}
+
\begin{bmatrix}
\mathbf{b} \\
\mathbf{c}
\end{bmatrix}
= \mathbf{0}$$
求解策略：</p>
<ol>
<li><strong>PGS迭代</strong>：适合实时，但收敛慢</li>
<li><strong>PATH求解器</strong>：鲁棒但需要许可证</li>
<li><strong>内点法</strong>：转化为QP问题</li>
</ol>
<p>实现建议：</p>
<ul>
<li>预处理改善条件数</li>
<li>温启动加速收敛</li>
<li>正则化处理奇异配置</li>
</ul>
</details>
<p><strong>练习7.8</strong> 接触参数的在线估计
设计一个算法在线估计接触刚度和阻尼系数。假设机器人末端与环境接触，接触模型为：
$$F_c = k_e(x - x_e) + b_e\dot{x}$$
<em>提示：使用递推最小二乘或卡尔曼滤波。</em></p>
<details>
<summary>参考答案</summary>
<p>扩展卡尔曼滤波方法：</p>
<p>状态向量：
$$\mathbf{x} = [x, \dot{x}, k_e, b_e, x_e]^T$$
系统模型：
$$\begin{aligned}
\dot{x} &amp;= v \\
\dot{v} &amp;= (F_{cmd} - k_e(x-x_e) - b_e v)/m \\
\dot{k}_e &amp;= 0 + w_{k} \\
\dot{b}_e &amp;= 0 + w_{b} \\
\dot{x}_e &amp;= 0 + w_{x}
\end{aligned}$$
测量模型：</p>
<ul>
<li>位置：$z_x = x + v_x$</li>
<li>力：$z_F = k_e(x-x_e) + b_e\dot{x} + v_F$</li>
</ul>
<p>EKF更新：</p>
<ol>
<li>
<p>预测：
$$\hat{\mathbf{x}}_{k|k-1} = f(\hat{\mathbf{x}}_{k-1}, u_{k-1})$$
   $$\mathbf{P}_{k|k-1} = \mathbf{F}_k\mathbf{P}_{k-1}\mathbf{F}_k^T + \mathbf{Q}$$</p>
</li>
<li>
<p>更新：
$$\mathbf{K}_k = \mathbf{P}_{k|k-1}\mathbf{H}_k^T(\mathbf{H}_k\mathbf{P}_{k|k-1}\mathbf{H}_k^T + \mathbf{R})^{-1}$$
   $$\hat{\mathbf{x}}_{k} = \hat{\mathbf{x}}_{k|k-1} + \mathbf{K}_k(\mathbf{z}_k - h(\hat{\mathbf{x}}_{k|k-1}))$$</p>
</li>
</ol>
<p>关键参数：</p>
<ul>
<li>过程噪声$\mathbf{Q}$：决定参数变化速度</li>
<li>测量噪声$\mathbf{R}$：基于传感器精度</li>
<li>初始协方差：反映参数不确定性</li>
</ul>
<p>验证方法：</p>
<ul>
<li>施加阶跃力，观察参数收敛</li>
<li>正弦激励，验证频率响应</li>
</ul>
</details>
<h2 id="_14">常见陷阱与错误</h2>
<ol>
<li>
<p><strong>数值积分不稳定</strong>
   - 错误：使用显式Euler积分刚性系统
   - 正确：使用隐式方法或可变步长求解器</p>
</li>
<li>
<p><strong>忽略耦合效应</strong>
   - 错误：独立设计各关节控制器
   - 正确：考虑惯量矩阵的非对角项</p>
</li>
<li>
<p><strong>摩擦补偿过度</strong>
   - 错误：完全消除摩擦
   - 正确：保留适当阻尼避免振荡</p>
</li>
<li>
<p><strong>参数辨识局部最优</strong>
   - 错误：使用单一初始值
   - 正确：多次随机初始化或全局优化</p>
</li>
<li>
<p><strong>忽略模型不确定性</strong>
   - 错误：假设模型完美
   - 正确：设计鲁棒控制器处理参数变化</p>
</li>
<li>
<p><strong>激励信号设计不当</strong>
   - 错误：使用单频正弦信号
   - 正确：宽频激励确保可辨识性</p>
</li>
</ol>
<h2 id="_15">最佳实践检查清单</h2>
<h3 id="_16">建模阶段</h3>
<ul>
<li>[ ] 选择合适的坐标系和参数化方法</li>
<li>[ ] 验证质量矩阵的对称性和正定性</li>
<li>[ ] 检查能量守恒（无摩擦无控制时）</li>
<li>[ ] 考虑关节限位和饱和</li>
</ul>
<h3 id="_17">参数辨识</h3>
<ul>
<li>[ ] 设计覆盖工作空间的激励轨迹</li>
<li>[ ] 多次实验取平均减少噪声</li>
<li>[ ] 验证参数的物理一致性</li>
<li>[ ] 交叉验证辨识结果</li>
</ul>
<h3 id="_18">实时实现</h3>
<ul>
<li>[ ] 选择合适的采样频率（&gt; 10倍带宽）</li>
<li>[ ] 优化计算（查表、并行化）</li>
<li>[ ] 实现故障检测和安全停机</li>
<li>[ ] 记录数据用于离线分析</li>
</ul>
<h3 id="_19">性能验证</h3>
<ul>
<li>[ ] 测试不同负载和速度</li>
<li>[ ] 评估跟踪精度和稳定裕度</li>
<li>[ ] 长时间运行测试</li>
<li>[ ] 极限工况测试</li>
</ul>
            </article>
            
            <nav class="page-nav"><a href="chapter6.html" class="nav-link prev">← 第6章：正逆运动学与工作空间</a><a href="chapter8.html" class="nav-link next">第8章：轨迹规划与优化 →</a></nav>
        </main>
    </div>
</body>
</html>